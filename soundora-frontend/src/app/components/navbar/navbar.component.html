<!-- Ã‰lÃ©ment principal de navigation avec classe CSS pour le style -->
<nav class="navbar">
  <!-- Conteneur principal qui centre et limite la largeur du contenu -->
  <div class="nav-container">
    
    <!-- Section du logo/titre du site -->
    <div class="nav-logo">
      <!-- Lien vers l'accueil avec routerLink (navigation Angular) -->
      <a routerLink="/" class="logo-link">
        <h1>Soundora</h1>
      </a>
    </div>

    <!-- Section contenant tous les liens de navigation -->
    <div class="nav-links">
      
      <!-- Lien vers la page d'accueil -->
      <!-- routerLinkActive="active" : Ajoute la classe 'active' quand la route est active -->
      <!-- [routerLinkActiveOptions]="{exact: true}" : Correspondance exacte requise -->
      <a routerLink="/" class="nav-link" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}">
        Accueil
      </a>
      
      <!-- === DROPDOWN MENU DES CATÃ‰GORIES === -->
      <!-- 
        MODIFICATION : Suppression du comportement de survol automatique
        - AVANT : (mouseleave)="closeDropdowns()" â†’ Fermait au survol
        - APRÃˆS : Aucun Ã©vÃ©nement de survol â†’ Gestion par clic uniquement
        
        OBJECTIF : Les dropdowns restent fermÃ©s au chargement et ne s'ouvrent QUE sur clic
        AVANTAGE : Interface plus propre, contrÃ´le total de l'utilisateur
      -->
      <div class="dropdown">
        
        <!-- Bouton dÃ©clencheur du dropdown -->
        <!-- 
          MODIFICATION : Suppression de (mouseenter)="openDropdown()"
          - AVANT : Ouverture au survol ET au clic
          - APRÃˆS : (click)="toggleDropdown()" UNIQUEMENT
          
          LOGIQUE : toggleDropdown() bascule entre ouvert/fermÃ© (true/false)
          COMPORTEMENT : 1er clic = ouvre, 2Ã¨me clic = ferme
        -->
        <button 
          class="dropdown-toggle nav-link" 
          (click)="toggleDropdown()">
          CatÃ©gories
          <!-- IcÃ´ne flÃ¨che qui tourne selon l'Ã©tat ouvert/fermÃ© -->
          <!-- [class.open] : Ajoute la classe CSS 'open' si isDropdownOpen est true -->
          <i class="dropdown-arrow" [class.open]="isDropdownOpen">â–¼</i>
        </button>
        
        <!-- Menu dÃ©roulant des catÃ©gories -->
        <!-- 
          FONCTIONNEMENT INCHANGÃ‰ : [class.show] contrÃ´le l'affichage CSS
          - show = true â†’ dropdown visible avec animation
          - show = false â†’ dropdown masquÃ©
          
          LIAISON : isDropdownOpen (boolÃ©en TypeScript) â†’ class CSS "show"
        -->
        <div class="dropdown-menu" [class.show]="isDropdownOpen">
          <!-- Boucle sur toutes les catÃ©gories avec *ngFor -->
          <!-- 
            COMPORTEMENT INCHANGÃ‰ : Clic sur une catÃ©gorie
            1. onCategorySelect(category.slug) â†’ Navigation vers /category/guitares
            2. closeDropdowns() â†’ Ferme automatiquement le dropdown aprÃ¨s sÃ©lection
          -->
          <a 
            *ngFor="let category of categories" 
            class="dropdown-item"
            (click)="onCategorySelect(category.slug)"
            [title]="category.description">
            <!-- Affiche le nom de la catÃ©gorie -->
            {{ category.name }}
          </a>
        </div>
      </div>

      <!-- === DROPDOWN MENU DES MARQUES === -->
      <!-- 
        MODIFICATION IDENTIQUE AU DROPDOWN CATÃ‰GORIES
        - SUPPRESSION : (mouseleave)="closeDropdowns()" 
        - SUPPRESSION : (mouseenter)="openBrandDropdown()"
        - CONSERVATION : (click)="toggleBrandDropdown()" uniquement
        
        COHÃ‰RENCE : MÃªme comportement pour tous les dropdowns de la navbar
      -->
      <div class="dropdown">
        
        <!-- Bouton dÃ©clencheur pour les marques -->
        <!-- 
          MODIFICATION : Gestion par clic uniquement
          - toggleBrandDropdown() : Bascule isBrandDropdownOpen (true â†” false)
          - Ferme automatiquement les autres dropdowns pour Ã©viter les conflits
        -->
        <button 
          class="dropdown-toggle nav-link" 
          (click)="toggleBrandDropdown()">
          Marques
          <!-- IcÃ´ne flÃ¨che liÃ©e Ã  l'Ã©tat du dropdown des marques -->
          <!-- [class.open] : Animation CSS basÃ©e sur isBrandDropdownOpen -->
          <i class="dropdown-arrow" [class.open]="isBrandDropdownOpen">â–¼</i>
        </button>
        
        <!-- Menu dÃ©roulant des marques -->
        <!-- 
          STRUCTURE IDENTIQUE AUX CATÃ‰GORIES
          - [class.show]="isBrandDropdownOpen" : ContrÃ´le CSS de l'affichage
          - *ngFor : Boucle sur le tableau brands[] rÃ©cupÃ©rÃ© de l'API
        -->
        <div class="dropdown-menu" [class.show]="isBrandDropdownOpen">
          <!-- Boucle sur toutes les marques -->
          <!-- 
            NAVIGATION : onBrandSelect(brand.slug) 
            - Exemple : clic sur "Fender" â†’ navigation vers /brand/fender
            - Fermeture automatique du dropdown aprÃ¨s sÃ©lection
          -->
          <a 
            *ngFor="let brand of brands" 
            class="dropdown-item"
            (click)="onBrandSelect(brand.slug)"
            [title]="brand.description">
            <!-- Affiche le nom de la marque -->
            {{ brand.name }}
          </a>
        </div>
      </div>

      <!-- === LIENS DE NAVIGATION CONDITIONNELS === -->
      
      <!-- Lien vers la page du panier (toujours visible) -->
      <a routerLink="/cart" class="nav-link" routerLinkActive="active">
        ðŸ›’ Panier
      </a>
      
      <!-- === SECTION AUTHENTIFICATION === -->
      <!-- Affichage conditionnel selon l'Ã©tat de connexion -->
      
      <!-- Si l'utilisateur N'EST PAS connectÃ© -->
      <div *ngIf="!isLoggedIn" class="auth-links">
        <a routerLink="/login" class="nav-link" routerLinkActive="active">
          Connexion
        </a>
      </div>
      
      <!-- Si l'utilisateur EST connectÃ© -->
      <div *ngIf="isLoggedIn" class="user-menu">
        
        <!-- Dropdown utilisateur -->
        <!-- 
          MODIFICATION COHÃ‰RENCE : Suppression de (mouseleave)="closeDropdowns()"
          - AVANT : Fermeture au survol automatique
          - APRÃˆS : Fermeture par clic uniquement ou clic extÃ©rieur
          
          LOGIQUE : MÃªme comportement que les autres dropdowns pour l'UX
        -->
        <div class="dropdown user-dropdown">
          
          <!-- Bouton utilisateur avec avatar -->
          <button 
            class="user-button" 
            (click)="toggleUserDropdown()"
            [class.active]="isUserDropdownOpen">
            
            <!-- Avatar avec initiale -->
            <div class="user-avatar">
              {{ getUserInitial() }}
            </div>
            
            <!-- Nom d'utilisateur -->
            <span class="user-name">{{ getUserDisplayName() }}</span>
            
            <!-- FlÃ¨che -->
            <i class="dropdown-arrow" [class.open]="isUserDropdownOpen">â–¼</i>
          </button>
          
          <!-- Menu dÃ©roulant utilisateur -->
          <div class="dropdown-menu user-menu-items" [class.show]="isUserDropdownOpen">
            
            <!-- Profil utilisateur -->
            <div class="user-info">
              <div class="user-email">{{ currentUser?.email }}</div>
              <div class="user-full-name" *ngIf="currentUser?.first_name || currentUser?.last_name">
                {{ currentUser?.first_name }} {{ currentUser?.last_name }}
              </div>
            </div>
            
            <!-- SÃ©parateur -->
            <div class="dropdown-divider"></div>
            
            <!-- Liens du menu utilisateur -->
            <a routerLink="/orders" class="dropdown-item">
              ðŸ“¦ Mes commandes
            </a>
            <a routerLink="/profile" class="dropdown-item">
              ðŸ‘¤ Mon profil
            </a>
            
            <!-- SÃ©parateur -->
            <div class="dropdown-divider"></div>
            
            <!-- Bouton de dÃ©connexion -->
            <button class="dropdown-item logout-button" (click)="logout()">
              ðŸšª Se dÃ©connecter
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</nav>
