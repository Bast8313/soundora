<!-- Section Hero optimis√©e - R√âDUITE -->
<section class="hero-section-mini">
  <div class="hero-content">
    <h1>Bienvenue chez Soundora</h1>
    <p>Votre boutique d'instruments de musique de r√©f√©rence</p>
  </div>
</section>

<div class="container">
  <div class="row">
    <!-- Titre de la section -->
    <div class="col-12 mb-4">
      <h2 class="section-title">{{ pageTitle }}</h2>
      <div class="title-divider"></div>
    </div>
    
    <!-- Filtres lat√©raux -->
    <div class="col-md-3">
      <div class="filters-panel">
        <h4>Filtres</h4>
        
        <!-- Recherche -->
        <div class="filter-group">
          <label for="search">Recherche</label>
          <input 
            type="text" 
            id="search"
            class="form-control"
            [(ngModel)]="searchQuery" 
            (keyup.enter)="onSearch()"
            placeholder="Chercher un produit...">
          <button class="btn btn-primary btn-sm mt-1" (click)="onSearch()">üîç</button>
        </div>

        <!-- Cat√©gories -->
        <div class="filter-group">
          <label for="category">Cat√©gorie</label>
          <select 
            id="category"
            class="form-control" 
            [(ngModel)]="selectedCategory" 
            (change)="onCategoryChange()">
            <option value="">Toutes les cat√©gories</option>
            <option *ngFor="let category of categories" [value]="category.slug">
              {{ category.name }}
            </option>
          </select>
        </div>

        <!-- Marques -->
        <div class="filter-group">
          <label for="brand">Marque</label>
          <select 
            id="brand"
            class="form-control" 
            [(ngModel)]="selectedBrand" 
            (change)="onBrandChange()">
            <option value="">Toutes les marques</option>
            <option *ngFor="let brand of brands" [value]="brand.slug">
              {{ brand.name }}
            </option>
          </select>
        </div>

        <!-- Prix -->
        <div class="filter-group">
          <label>Prix</label>
          <div class="price-range">
            <input 
              type="number" 
              class="form-control form-control-sm"
              [(ngModel)]="priceMin" 
              placeholder="Min ‚Ç¨"
              (change)="onPriceFilter()">
            <span>-</span>
            <input 
              type="number" 
              class="form-control form-control-sm"
              [(ngModel)]="priceMax" 
              placeholder="Max ‚Ç¨"
              (change)="onPriceFilter()">
          </div>
        </div>

        <!-- Bouton reset -->
        <button class="btn btn-secondary btn-sm" (click)="clearFilters()">
         Effacer les filtres
        </button>
      </div>
    </div>

    <!-- Liste des produits -->
    <div class="col-md-9">
      <!-- En-t√™te avec r√©sultats -->
      <div class="products-header">
        <h2>üé∏ Nos Instruments</h2>
        <div class="results-info" *ngIf="!loading">
          {{ totalItems }} produit{{ totalItems > 1 ? 's' : '' }} trouv√©{{ totalItems > 1 ? 's' : '' }}
        </div>
      </div>

      <!-- Loader -->
      <div *ngIf="loading" class="text-center">
        <div class="spinner-border" role="status">
          <span class="visually-hidden">Chargement...</span>
        </div>
      </div>

      <!-- Grille de produits -->
      <div class="products-grid" *ngIf="!loading">
        <!-- Utilise le slug au lieu de l'ID pour des URLs SEO-friendly -->
        <div class="product-card" *ngFor="let product of products" [routerLink]="['/product', product.slug]">
          <!-- Image produit -->
          <div class="product-image">
            <img [src]="getMainImage(product)" [alt]="product.name" 
                 onerror="this.src='/assets/images/no-image.jpg'">
            <div class="product-featured" *ngIf="product.is_featured">‚≠ê</div>
          </div>

          <!-- Informations produit -->
          <div class="product-info">
            <div class="product-brand" *ngIf="product.brands?.name">{{ product.brands.name }}</div>
            <h5 class="product-name">{{ product.name }}</h5>
            <p class="product-description">{{ product.short_description }}</p>
            
            <!-- Prix -->
            <div class="product-pricing">
              <span class="current-price">{{ formatPrice(product.price) }}</span>
              <span class="original-price" *ngIf="product.compare_price">
                {{ formatPrice(product.compare_price) }}
              </span>
            </div>

            <!-- Stock et cat√©gorie -->
            <div class="product-meta">
              <span class="stock" [class.low-stock]="product.stock <= 2">
               {{ product.stock }} en stock
              </span>
              <span class="category" *ngIf="product.categories?.name">{{ product.categories.name }}</span>
            </div>

            <!-- Couleur et mod√®le -->
            <div class="product-details" *ngIf="product.color || product.model">
              <span *ngIf="product.color" class="color">{{ product.color }}</span>
              <span *ngIf="product.model" class="model">{{ product.model }}</span>
            </div>
          </div>

          <!-- Actions -->
          <div class="product-actions">
            <!-- Bouton d'ajout au panier avec gestion du clic -->
            <button class="btn btn-primary btn-sm" 
                    (click)="addToCart(product, $event)"
                    [disabled]="product.stock === 0">
              üõí {{ product.stock === 0 ? 'Rupture' : 'Ajouter au panier' }}
            </button>
            <a [routerLink]="['/product', product.slug]" class="btn btn-outline-secondary btn-sm">
             Voir d√©tails
            </a>
          </div>
        </div>
      </div>

      <!-- Message si aucun produit -->
      <div *ngIf="!loading && products.length === 0" class="no-products">
        <h4> Aucun produit trouv√©</h4>
        <p>Essayez de modifier vos filtres de recherche.</p>
      </div>

      <!-- Pagination -->
      <nav *ngIf="!loading && totalPages > 1" class="pagination-wrapper">
        <ul class="pagination justify-content-center">
          <li class="page-item" [class.disabled]="currentPage === 1">
            <button class="page-link" (click)="previousPage()" [disabled]="currentPage === 1">
              Pr√©c√©dent
            </button>
          </li>
          
          <li class="page-item" 
              *ngFor="let page of getPagesArray()" 
              [class.active]="currentPage === page">
            <button class="page-link" (click)="goToPage(page)">
              {{ page }}
            </button>
          </li>
          
          <li class="page-item" [class.disabled]="currentPage === totalPages">
            <button class="page-link" (click)="nextPage()" [disabled]="currentPage === totalPages">
              Suivant
            </button>
          </li>
        </ul>
      </nav>
    </div>
  </div>
</div>
